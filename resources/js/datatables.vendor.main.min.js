window.addParameterToURL = function(url, paramName, paramValue)
{
    url += (url.split('?')[1] ? '&':'?') + paramName + '=' + paramValue;

    return url;
}

window.__showTableDuplicates = function(table)
{
    let _table = table.table().node();

    $(_table).find('th.doubler').each(function ()
    {
        var columnIndex = $(this).data('column');
        var columnName = $(this).data('camelname');
        var names = window.__getTableArrayNames(table, columnIndex);
        window.__showDuplicates(table, names, columnIndex, columnName);
    });
}

window.reloadDatatable = function(table)
{
    table.ajax.reload(function ()
    {
        window.__showTableDuplicates(table);
    });
}

$(document).ready(function($)
{
    $('body').on( 'mouseenter', '.uk-text-truncate', function(){
        var $this = $(this);

        if(this.offsetWidth < this.scrollWidth && !$this.attr('title')){
            $this.attr('title', $this.text());
            UIkit.tooltip($this, {title: $this.text()}).show();
        }
    });

    $('.wannabedatatable').each(function()
    {
        let tableId = $(this).attr('id');
        let columnDefs = window[tableId + 'columnDefs'];
        let rowReorder = window[tableId + 'rowReorder'];
        let options = window[tableId + 'options'];
        let buttons = window[tableId + 'buttons'];

        let summary = (typeof $('#' + tableId).data('summary') !== 'undefined');

        let settings = {
            processing: true,
            orderCellsTop: true,
            searchDelay: 450,
            lengthMenu: [[10, 25, 50, 100, 250, 500, -1], [10, 25, 50, 100, 250, 500, "All"]],
            columnDefs : columnDefs,
            rowReorder : rowReorder,
            buttons: {
                dom: {
                    button: {
                        className: 'uk-button uk-button-small uk-button-primary'
                    }
                },
                buttons: buttons
            },
            initComplete: function ()
            {
                if (typeof $('#' + tableId).data('sticky') !== 'undefined')
                  UIkit.sticky($('#' + tableId + '_wrapper').find('.' + $('#' + tableId).data('sticky')), {bottom: true});

                this.api().columns().every(function ()
                {
                    // normalFilter(this, this.header());

                    // // var that = this;

                    if($(this.header()).data('range'))
                        window.rangeFilter(this, this.header());
                    else
                        window.normalFilter(this, this.header());
                });

                if(typeof window[tableId + 'options'].caption !== 'undefined')
                    $('#' + tableId + '_wrapper .tablecaption').html(window[tableId + 'options'].caption);

                $('#' + tableId + '_wrapper .dataTables_length select').addClass('uk-select');
                $('#' + tableId + '_filter input').addClass('uk-input').attr('placeholder', window[tableId + 'options'].language.searchPlaceholder);
            },
            drawCallback: function(settings)
            {
                var api = this.api();

                if(summary)
                    window.populateFilteredColumnValues(api, tableId);

                api.columns.adjust();
            }
        };

        jQuery.extend(settings, options);

        window['table' + tableId] = $(this).DataTable(settings)
            .on('key-blur', function ( e, datatable, cell ) {
                $(cell.node()).find('input').blur();
                $(cell.node()).find('select').blur();
            })
            .on('key-focus', function ( e, datatable, cell ) {

                setTimeout(function()
                {
                    $(cell.node()).find('input').focus();
                }, 150);
            });
    })

});   
