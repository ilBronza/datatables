(function registerilBronzaDatatablesButtons() {
    if ($.fn.dataTable && $.fn.dataTable.Api) {

        $.fn.dataTable.Api.register( 'activateButton()', function (button, activate = true)
{
    if(activate)
        return $(button).addClass('uk-button-primary');

    return $(button).removeClass('uk-button-primary');
} );

$.fn.dataTable.Api.register( 'deactivateButton()', function (button)
{
    return this.activateButton(button, false);
});

$.fn.dataTable.ext.buttons.fieldsVisibility = {
    text: window.fieldsVisibilityString,
  action: function action(e, dt, node, config) {
    let id = $(node).parents('.dt-container').find('table').data('realid');
    $('#offcanvastogglefieldsbutton' + id).click();
  }
};

$.fn.dataTable.ext.buttons.search = {
    text: 'Apply search',
    action: function ( e, dt, node, config ) {
        dt.draw();
    }
};

$.fn.dataTable.ext.buttons.reload = {
    text: 'Reload',
    action: function ( e, dt, node, config ) {
        // native DataTables reload (triggers processing spinner)
        dt.ajax.reload(null, false);
    }
};

$.fn.dataTable.ext.buttons.selectedRows =
{
    extend: 'selected',
    text: 'Solo selezionate',
    action: function ( e, dt, node, config )
    {
        dt.toggleShowSelected();

        let showSelected = dt.getDataAttribute('showSelected');

        dt.activateButton(node, showSelected);

        if(showSelected)
            dt.rows({ selected: false }).nodes().to$().css({"display":"none"});

        else
            dt.rows({ selected: false }).nodes().to$().css({"display":"table-row"});

        dt.draw();
    }
};

$.fn.dataTable.ext.buttons.doubler =
{
    text: 'Mostra duplicati',
    action: function ( e, dt, node, config )
    {
        dt.toggleShowDuplicates();

        let showDuplicates = dt.getDataAttribute('showDuplicates');

        dt.activateButton(node, showDuplicates);

        if(showDuplicates)
            window.__showTableDuplicates(dt);
    }
};

$.fn.dataTable.ext.buttons.removeSummary = {
    text: 'Riepilogo',
    action: function ( e, dt, node, config ) {

        $(node).toggleClass('uk-button-danger');

        $(node).parents('.dt-container').find('tr.summary').toggle();
    }
};

$.extend(true, $.fn.dataTable.ext.classes, {
    paging: {
        button: 'uk-button uk-button-small ib-dt-paging-button',
    }
});

$.fn.dataTable.ext.buttons.removeInlineSearch = {
    text: 'Riepilogo filtrato',
    action: function ( e, dt, node, config )
    {
        dt.toggleSummary();

        let summaryActive = dt.hasSummaryActive();

        dt.activateButton(node, summaryActive);

        if(summaryActive)
            $(node).parents('.dt-container').find('tr.inlinesearchsummary').fadeIn();

        else
            $(node).parents('.dt-container').find('tr.inlinesearchsummary').fadeOut();

        dt.draw();
    }
};
    } else {
        // Riprova dopo un attimo
        setTimeout(registerilBronzaDatatablesButtons, 100);
    }
})();
